<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>EcoBlend Coffee Shop Sustainability Calculator</title>
  <meta name="description" content="EcoBlend’s friendly, framework-aligned self-assessment for coffee shops." />
  <style>
    :root{
      --bg:#f9f6f2; --panel:#ffffff; --muted:#5f6a65; --accent:#2e6445; --gold:#d4af37; --coffee:#7b5a39;
      --radius:16px; --shadow:0 10px 30px rgba(37,53,46,0.08);
      --sans:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif;
      --display:"Playfair Display", Georgia, "Times New Roman", serif;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:var(--sans);color:#18392a}
    header{position:sticky;top:0;background:linear-gradient(90deg,#fff, #f8f4ee 40%, #f0f6f2);border-bottom:1px solid #ecefe9;z-index:30}
    .wrap{max-width:1120px;margin:0 auto;padding:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:40px;height:40px;border-radius:12px;background:linear-gradient(180deg,#2e6445,#5aa87e);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
    h1{margin:0;font-size:24px;color:var(--coffee);font-family:var(--display)}
    .subtitle{color:var(--muted);margin-top:6px;font-size:14px}
    .tabs{display:flex;gap:8px;margin-top:12px;flex-wrap:wrap}
    .tab{padding:8px 12px;border:1px solid #cfe0d7;border-radius:999px;background:#eef7f2;cursor:pointer}
    .tab.active{background:var(--accent);color:#fff;border-color:var(--accent)}
    main .wrap{padding-top:14px;padding-bottom:180px}

    .start{display:flex;gap:10px;align-items:center;margin:8px 0 10px 0}
    .start input{padding:10px 12px;border:1px solid #dfe6e1;border-radius:10px}
    .start .btn{margin-left:6px}

    .card{background:var(--panel);border:1px solid #e2ebe5;border-radius:var(--radius);
      box-shadow:var(--shadow);padding:14px;margin:10px 0}
    .head{display:flex;justify-content:space-between;gap:10px;align-items:flex-start}
    .sub{font-size:12px;color:var(--muted)}
    .label{font-weight:700}
    .row{display:grid;grid-template-columns:1fr auto auto;gap:12px;align-items:center;margin-top:10px}
    input[type="number"], select{width:100%;padding:10px;border-radius:12px;border:1px solid #dfe6e1}
    input[type="range"]{width:100%}
    .pill{padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid #d9e9e1;background:#f3fbf7;white-space:nowrap}

    details.info > summary{list-style:none;cursor:pointer;display:inline-flex;align-items:center;gap:6px;margin-top:6px}
    details.info > summary::before{content:"ⓘ";display:inline-block;border:1px solid #cfe0d7;border-radius:999px;padding:0 6px;background:#eef7f2;font-size:12px}
    details.info[open] > summary::before{background:var(--accent);color:white;border-color:var(--accent)}
    details.info > div{margin-top:8px;background:#f6fbf8;border:1px solid #def0e6;border-radius:12px;padding:10px;line-height:1.5}
    .sdgbadge{display:inline-flex;align-items:center;gap:6px;border:1px solid #d1e7dc;background:#eef9f3;border-radius:999px;padding:2px 8px;font-size:11px;margin:4px 6px 0 0}
    .sdgbadge img{width:16px;height:16px;border-radius:3px;display:inline-block}

    .stats{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:8px}
    .toolbar{position:fixed;left:0;right:0;bottom:0;background:#fff;border-top:1px solid #e8eee9}
    .toolbar .wrap{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid #cfe0d7;background:#eaf3ef;border-radius:12px;padding:10px 14px;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
    .score{margin-left:auto;font-weight:700}
    progress{width:220px;height:12px;border:1px solid #dfe6e1;border-radius:999px;overflow:hidden;background:#f3f7f5}
    progress::-webkit-progress-bar{background:#f3f7f5}
    progress::-webkit-progress-value{background:var(--accent)}

    .tier{display:inline-flex;align-items:center;gap:8px}
    .tier .dot{width:10px;height:10px;border-radius:999px;display:inline-block}

    footer{position:sticky;bottom:60px;border-top:1px solid #e8eee9;color:var(--muted);
      font-size:12px;padding:16px;text-align:center;background:linear-gradient(180deg,#fff,rgba(255,255,255,.9))}

    /* Certificate */
    #certificate{display:none; background:white; color:#222; padding:24px; border:1px solid #e6e6e6; border-radius:16px; box-shadow:0 8px 30px rgba(0,0,0,.06); margin-top:18px}
    #certificate .frame{border:3px solid #d4af37;border-radius:16px;padding:20px;background:linear-gradient(180deg,#fff,#fffef7)}
    #certificate h2{margin:0 0 6px 0; color:#2e6445; font-family:var(--display); font-size:26px}
    #certificate .brandrow{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    #certificate .brandmark{display:flex;align-items:center;gap:10px}
    #certificate .brandmark .logo{width:42px;height:42px;border-radius:12px;background:linear-gradient(180deg,#2e6445,#5aa87e);display:flex;align-items:center;justify-content:center;color:white;font-weight:800}
    #certificate .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px; margin-top:8px}
    #certificate .quote{margin-top:16px; color:#555; font-style:italic}
    #certificate .small{color:#666; font-size:12px; margin-top:12px}
    #locknote{margin-top:8px;color:#7b5a39}

    @media print{
      header, .toolbar, footer, .tabs, .start { display:none !important; }
      body{ background:white }
      #certificate{ display:block; box-shadow:none; border:none; margin-top:0 }
      main .wrap > *:not(#certificate){ display:none !important }
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="brand">
        <div class="logo">E</div>
        <div>
          <h1>EcoBlend Coffee Shop Sustainability Calculator</h1>
          <div class="subtitle">Answer simple questions. Get your score, tier, and a certificate (from Bronze and up). Weights remain hidden.</div>
        </div>
      </div>
      <div class="start">
        <label for="cafename">Café name:</label>
        <input id="cafename" placeholder="Type your café name" />
        <button class="btn" id="saveName">Save name</button>
      </div>
      <div class="tabs" id="tabs"></div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <div id="list"></div>

      <div class="stats">
        <div class="card">
          <div class="label">Section Scores</div>
          <div id="secScores" class="help" style="margin-top:8px"></div>
        </div>
        <div class="card">
          <div class="label">Your Result</div>
          <div class="help">Overall score and tier based on your answers.</div>
          <div style="display:flex;align-items:center;gap:12px;margin-top:12px;">
            <progress id="prog" max="100" value="0"></progress>
            <div class="score" id="overallScore">0</div>
          </div>
          <div class="tier" style="margin-top:8px">
            <span class="dot" id="tierDot" style="background:#9aa5a1"></span>
            <span id="tier">No tier yet</span>
          </div>
          <div id="locknote" class="help">Reach at least <strong>50</strong> (Bronze) to unlock your EcoBlend certificate.</div>
          <button class="btn primary" id="print" style="display:none;margin-top:10px;">Open Certificate (Print/Save PDF)</button>
        </div>
      </div>

      <!-- Certificate (print view) -->
      <section id="certificate" class="card">
        <div class="frame">
          <div class="brandrow">
            <div class="brandmark">
              <div class="logo">E</div>
              <div>
                <div style="font-weight:800;letter-spacing:.5px;">EcoBlend</div>
                <div style="font-size:12px;color:#5f6a65">Sustainability Simplified</div>
              </div>
            </div>
            <div style="font-size:12px;color:#5f6a65">Issued: <span id="certDate"></span></div>
          </div>
          <h2>EcoBlend Sustainability Certificate</h2>
          <div style="margin:6px 0 10px 0;">This certifies that <strong id="certCafe">Your Café</strong> has achieved</div>
          <div style="display:flex;align-items:center;gap:12px;margin:8px 0;">
            <div id="tierBadge" style="padding:6px 12px;border-radius:12px;border:1px solid #ddd;background:#f7fbf8;font-weight:700;">Tier</div>
            <div id="certScore" style="font-weight:700">0/100</div>
          </div>
          <div class="grid">
            <div><strong>Planet:</strong> <span id="certPlanet">0%</span></div>
            <div><strong>People:</strong> <span id="certPeople">0%</span></div>
            <div><strong>Profit & Supply Chain:</strong> <span id="certProfit">0%</span></div>
            <div><strong>Focus next on:</strong> <span id="focusAreas">—</span></div>
          </div>
          <div class="quote">“Small steps make strong roots.” — Effie Karozou</div>
          <div style="margin-top:14px">Certified by <strong>Effie Karozou | EcoBlend — Sustainability Simplified</strong></div>
          <div class="small">© 2025 Effie Karozou — All rights reserved. — Developed by EcoBlend | Effie’s Sustainable Coffee Shop Initiative</div>
        </div>
      </section>
    </div>
  </main>

  <div class="toolbar">
    <div class="wrap">
      <button class="btn" id="reset">Reset</button>
      <button class="btn" id="export">Export (CSV)</button>
      <button class="btn primary" id="print2" style="display:none;">Open Certificate</button>
      <span class="help" style="color:var(--muted)">Your answers are saved locally in this browser.</span>
    </div>
  </div>

  <footer>
    © 2025 Effie Karozou — All rights reserved. — Developed by EcoBlend | Effie’s Sustainable Coffee Shop Initiative
  </footer>

  <script>
  const ITEMS = [{"id": "PL_WASTE_TRACK", "sec": "Planet", "sub": "Waste", "label": "Do you track daily coffee & food waste?", "type": "tri", "why": "Tracking reveals patterns, saves costs, and prevents waste.", "how": "Weigh food waste daily/weekly; log wasted cups; review monthly.", "sdgs": [12], "weight": 4}, {"id": "PL_WASTE_SORT", "sec": "Planet", "sub": "Waste", "label": "Do you separate waste into recyclables, organics, and residuals?", "type": "tri", "why": "Sorting enables recycling/composting, reducing landfill.", "how": "Place clear signage at bins; audit contamination weekly.", "sdgs": [12], "weight": 4}, {"id": "PL_REUSABLES", "sec": "Planet", "sub": "Packaging", "label": "Share of on‑premise drinks served in reusables (mugs/glasses)", "type": "percent", "why": "Reusables cut single‑use waste and costs.", "how": "Default to mugs for dine‑in; train staff to prompt 'for here or to go?'.", "sdgs": [12], "weight": 3}, {"id": "PL_CUPS_BOTTLES", "sec": "Planet", "sub": "Packaging", "label": "Do you avoid selling bottled water and single‑use plastic cups on premises?", "type": "tri", "why": "Avoiding single‑use items reduces waste and ocean plastic.", "how": "Provide filtered tap water; sell/loan reusable bottles and mugs.", "sdgs": [12, 14], "weight": 3}, {"id": "PL_REFILL", "sec": "Planet", "sub": "Packaging", "label": "Do you offer a refill/bring‑your‑own cup program?", "type": "tri", "why": "Refill schemes reduce waste and engage customers.", "how": "Give small discount or stamp for reusables; display at POS.", "sdgs": [12], "weight": 2}, {"id": "PL_GROUNDS", "sec": "Planet", "sub": "Circularity", "label": "Spent coffee grounds diverted to compost or reuse partners (%)", "type": "percent", "why": "Keeps organics out of landfill and supports local loops.", "how": "Partner with gardeners/farms; schedule weekly pickups.", "sdgs": [12], "weight": 3}, {"id": "PL_EN_LED", "sec": "Planet", "sub": "Energy", "label": "Interior lighting is LED or equivalent efficient (0–5)", "type": "scale", "why": "Efficient lighting lowers energy bills and emissions.", "how": "Replace remaining bulbs; add occupancy sensors where possible.", "sdgs": [7, 13], "weight": 3}, {"id": "PL_EN_MAINT", "sec": "Planet", "sub": "Energy", "label": "Equipment preventive maintenance is on schedule (espresso, refrigeration)", "type": "tri", "why": "Maintenance improves efficiency and extends lifespan.", "how": "Calendar for descale, filters, gaskets and fridge seals.", "sdgs": [12, 9], "weight": 2}, {"id": "PL_EN_SOURCE", "sec": "Planet", "sub": "Energy", "label": "Share of electricity from renewables (%)", "type": "percent", "why": "Renewables reduce carbon footprint and future energy risk.", "how": "Switch to green tariff; consider rooftop PV where feasible.", "sdgs": [7, 13], "weight": 3}, {"id": "PL_WATER_FIX", "sec": "Planet", "sub": "Water", "label": "Low‑flow taps/flush and spray nozzles installed (0–5)", "type": "scale", "why": "Conserves water without harming service quality.", "how": "Fit aerators & efficient spray heads; keep filters clean.", "sdgs": [6, 12], "weight": 2}, {"id": "PL_WATER_LOG", "sec": "Planet", "sub": "Water", "label": "Filter changes logged and routine leak checks performed", "type": "tri", "why": "Protects equipment and reduces water loss.", "how": "Log filter dates; do monthly meter checks & leak sweeps.", "sdgs": [6], "weight": 2}, {"id": "PL_CLIMATE_YOY", "sec": "Planet", "sub": "Climate", "label": "Electricity use intensity improved vs. last year (0–5)", "type": "scale", "why": "Year‑on‑year efficiency shows climate progress.", "how": "Track kWh per m²/transaction; set an annual target.", "sdgs": [13, 7], "weight": 2}, {"id": "PL_BIODIVERSITY", "sec": "Planet", "sub": "Biodiversity", "label": "Do you avoid products linked to deforestation and protect biodiversity?", "type": "tri", "why": "Protecting ecosystems secures long‑term coffee supply.", "how": "Ask suppliers about agroforestry and deforestation‑free sourcing.", "sdgs": [15, 12, 13], "weight": 3}, {"id": "PL_VEGAN", "sec": "Planet", "sub": "Menu", "label": "Share of plant‑based/vegan menu options (%)", "type": "percent", "why": "Plant‑based options lower emissions and broaden inclusivity.", "how": "Offer alt‑milks at price parity; add vegan pastries/meals.", "sdgs": [12, 13, 3], "weight": 3}, {"id": "PL_MILK_PARITY", "sec": "Planet", "sub": "Menu", "label": "Share of milk alternatives offered at equal price with dairy (%)", "type": "percent", "why": "Parity removes cost barriers to lower‑impact choices.", "how": "Price‑match oat/soy with dairy; show options clearly on menu.", "sdgs": [12, 13], "weight": 3}, {"id": "PL_LEGAL_ENV", "sec": "Planet", "sub": "Compliance", "label": "Environmental law compliance (waste, permits, grease traps, etc.)", "type": "tri", "why": "Compliance prevents penalties and builds trust.", "how": "Keep permits current; maintain inspection records & schedules.", "sdgs": [12, 16], "weight": 3}, {"id": "PE_LIVING_WAGE", "sec": "People", "sub": "Fair Work", "label": "Commitment to pay at least a living wage for all staff", "type": "tri", "why": "Fair pay supports decent work and retention.", "how": "Adopt a written policy; review wages yearly vs living‑wage data.", "sdgs": [8, 10], "weight": 4}, {"id": "PE_SCHED_NOTICE", "sec": "People", "sub": "Fair Work", "label": "Schedules shared ≥2 weeks in advance", "type": "tri", "why": "Predictability supports staff well‑being.", "how": "Publish rota early; minimize last‑minute changes; track swaps.", "sdgs": [8, 3], "weight": 2}, {"id": "PE_TRAINING", "sec": "People", "sub": "Growth", "label": "Average annual training hours per person (0–5)", "type": "scale", "why": "Training improves quality, safety, and careers.", "how": "Plan coffee skills + safety + sustainability per role.", "sdgs": [8, 4, 12], "weight": 2}, {"id": "PE_SAFETY", "sec": "People", "sub": "Health & Safety", "label": "Safety incidents and near‑misses are tracked and reviewed", "type": "tri", "why": "Learning from incidents prevents harm.", "how": "Use a simple form; review monthly; act on patterns.", "sdgs": [3, 8], "weight": 3}, {"id": "PE_EQUALITY", "sec": "People", "sub": "Inclusion", "label": "Non‑discrimination and equal opportunity policy in place", "type": "tri", "why": "A safe, inclusive workplace retains talent.", "how": "Share policy at onboarding; provide reporting channels.", "sdgs": [5, 10], "weight": 2}, {"id": "PE_GENDER", "sec": "People", "sub": "Inclusion", "label": "Team is reasonably gender‑balanced across roles (0–5)", "type": "scale", "why": "Diverse teams reflect your community.", "how": "Track representation; audit hiring & promotion fairness.", "sdgs": [5, 10], "weight": 2}, {"id": "PE_ACCESS", "sec": "People", "sub": "Customer Access", "label": "The venue is accessible (entrance, signage, restroom)", "type": "tri", "why": "Accessibility broadens your community.", "how": "Use a quick access checklist; add ramps and clearer signage.", "sdgs": [10, 11], "weight": 2}, {"id": "PE_COMMUNITY", "sec": "People", "sub": "Community", "label": "Community support level", "type": "select", "options": [{"label": "No", "val": 0}, {"label": "Some (≤0.5% or ≤10h/yr)", "val": 2}, {"label": "Good (≈1% or 11–20h/yr)", "val": 4}, {"label": "Strong (≥1% or >20h/yr)", "val": 5}], "why": "Giving back builds social capital and loyalty.", "how": "Partner with local groups; set a simple yearly giving plan.", "sdgs": [11, 17], "weight": 2}, {"id": "PE_LAW", "sec": "People", "sub": "Compliance", "label": "Labor law compliance (contracts, breaks, overtime, safety)", "type": "tri", "why": "Legal compliance protects people and the business.", "how": "Keep records of contracts, training, and hours; audit yearly.", "sdgs": [8, 16], "weight": 3}, {"id": "PR_TRACE", "sec": "Profit", "sub": "Sourcing", "label": "Coffee is traceable to origin (farm/co‑op) for most volume", "type": "tri", "why": "Traceability builds trust and resilience.", "how": "Ask roasters for farm/co‑op & lot info; store purchase docs.", "sdgs": [12, 17], "weight": 4}, {"id": "PR_CERT", "sec": "Profit", "sub": "Sourcing", "label": "Share of certified/verified coffee purchased (%)", "type": "percent", "why": "Assurance supports producers and ecosystems.", "how": "Start with a portion of certified beans; scale up over time.", "sdgs": [12, 15, 1], "weight": 3}, {"id": "PR_SUPPLIER_CODE", "sec": "Profit", "sub": "Governance", "label": "Suppliers sign a simple Code of Conduct (labor, env, ethics)", "type": "tri", "why": "Sets expectations across your supply chain.", "how": "Use a one‑page code; collect signatures during onboarding.", "sdgs": [8, 12, 17], "weight": 4}, {"id": "PR_LOCAL", "sec": "Profit", "sub": "Local Economy", "label": "Share of non‑coffee inputs sourced locally (%)", "type": "percent", "why": "Supports local SMEs and reduces transport impacts.", "how": "Prioritize local milk, bakery, packaging, and services.", "sdgs": [11, 12], "weight": 2}, {"id": "PR_MENU_IMPACT", "sec": "Profit", "sub": "Menu & Design", "label": "You highlight low‑impact choices (plant‑based, seasonal, tap water)", "type": "tri", "why": "Nudges help customers choose better.", "how": "Use menu icons/placement; train staff on scripts.", "sdgs": [12, 3, 13], "weight": 2}, {"id": "PR_TRANSPARENCY", "sec": "Profit", "sub": "Transparency", "label": "You publish a simple annual sustainability summary", "type": "tri", "why": "Transparency builds accountability and brand trust.", "how": "Post 6–8 KPIs and actions on your website or socials.", "sdgs": [12, 16], "weight": 3}, {"id": "PR_DATA", "sec": "Profit", "sub": "Data", "label": "You track key sustainability KPIs quarterly (waste, reusables, energy)", "type": "tri", "why": "Data turns goals into action.", "how": "Review trends each quarter and adjust operations.", "sdgs": [12, 13, 9], "weight": 3}, {"id": "PR_FAIR_PRICING", "sec": "Profit", "sub": "Sourcing", "label": "You discuss price fairness with suppliers/roasters", "type": "tri", "why": "Supports producer livelihoods and long‑term ties.", "how": "Agree on quality premiums or long‑term terms where possible.", "sdgs": [8, 1, 12], "weight": 3}, {"id": "PR_IMPROVE", "sec": "Profit", "sub": "Improvement", "label": "Have you implemented a sustainability improvement in the last 3 years?", "type": "tri", "why": "Continuous improvement matters more than yearly spend.", "how": "Choose one action (reuse scheme, composting, green tariff) and review results.", "sdgs": [9, 12], "weight": 2}, {"id": "PR_LAW", "sec": "Profit", "sub": "Compliance", "label": "Business compliance (tax, health inspections, data privacy)", "type": "tri", "why": "Good governance reduces risk and protects reputation.", "how": "Keep inspection reports & filings; set reminders for renewals.", "sdgs": [16, 12], "weight": 3}];
  const SECTION_WEIGHTS = {"Planet": 0.4, "People": 0.35, "Profit": 0.25};
  const SDG_IMG = {"1": "https://sdgs.un.org/sites/default/files/2020-09/Goal-01.png", "2": "https://sdgs.un.org/sites/default/files/2020-09/Goal-02.png", "3": "https://sdgs.un.org/sites/default/files/2020-09/Goal-03.png", "4": "https://sdgs.un.org/sites/default/files/2020-09/Goal-04.png", "5": "https://sdgs.un.org/sites/default/files/2020-09/Goal-05.png", "6": "https://sdgs.un.org/sites/default/files/2020-09/Goal-06.png", "7": "https://sdgs.un.org/sites/default/files/2020-09/Goal-07.png", "8": "https://sdgs.un.org/sites/default/files/2020-09/Goal-08.png", "9": "https://sdgs.un.org/sites/default/files/2020-09/Goal-09.png", "10": "https://sdgs.un.org/sites/default/files/2020-09/Goal-10.png", "11": "https://sdgs.un.org/sites/default/files/2020-09/Goal-11.png", "12": "https://sdgs.un.org/sites/default/files/2020-09/Goal-12.png", "13": "https://sdgs.un.org/sites/default/files/2020-09/Goal-13.png", "14": "https://sdgs.un.org/sites/default/files/2020-09/Goal-14.png", "15": "https://sdgs.un.org/sites/default/files/2020-09/Goal-15.png", "16": "https://sdgs.un.org/sites/default/files/2020-09/Goal-16.png", "17": "https://sdgs.un.org/sites/default/files/2020-09/Goal-17.png"};
  const TIERS = [{"name": "Platinum", "min": 90, "color": "#3eb489"}, {"name": "Gold", "min": 80, "color": "#d4af37"}, {"name": "Silver", "min": 65, "color": "#c0c0c0"}, {"name": "Bronze", "min": 50, "color": "#cd7f32"}, {"name": "Starter", "min": 0, "color": "#9aa5a1"}];
  const KEY = "ecoblend-coffee-sust-v4";
  let state = JSON.parse(localStorage.getItem(KEY) || "{}");

  const cats = [...new Set(ITEMS.map(i => i.sec))];
  let active = state._active || cats[0];

  function $(q){ return document.querySelector(q); }
  function el(tag, cls){ const e=document.createElement(tag); if(cls) e.className=cls; return e; }

  function renderTabs() {
    const tabsEl = $("#tabs"); tabsEl.innerHTML = "";
    cats.forEach(c => {
      const b = el("button","tab"+(c===active?" active":""));
      b.textContent = c;
      b.onclick = () => { active=c; state._active=c; save(); render(); };
      tabsEl.appendChild(b);
    });
  }

  function sdgBadges(sdgs){
    return (sdgs||[]).map(n => '<span class="sdgbadge"><img src="'+(SDG_IMG[n]||'')+'" alt="SDG '+n+'"/><span>SDG '+n+'</span></span>').join("");
  }

  function inputFor(item){
    const id=item.id; const container = el("div","row");
    let input = null; let display = el("div");
    if(item.type==="tri"){
      input = el("select");
      [["No",0],["Partly",2],["Yes",5]].forEach(([t,v])=>{const o=el("option"); o.value=v; o.textContent=t; input.appendChild(o);});
      input.value = (state[id]!==undefined) ? state[id] : 0;
      input.oninput = (e)=>{ state[id]=Number(e.target.value); save(); calc(); };
      display.innerHTML = '<span class="pill">Choose: No / Partly / Yes</span>';
    } else if(item.type==="percent"){
      input = el("input"); input.type="number"; input.min="0"; input.max="100"; input.step="0.1";
      input.value = (state[id]!==undefined) ? state[id] : "";
      input.placeholder="0–100";
      input.oninput = (e)=>{ state[id]=Number(e.target.value||0); save(); calc(); };
      display.innerHTML = '<span class="pill">Enter a percentage (0–100)</span>';
    } else if(item.type==="scale"){
      input = el("input"); input.type="range"; input.min="0"; input.max="5"; input.step="1";
      input.value = (state[id]!==undefined) ? state[id] : 0;
      const val = el("div"); val.className="pill"; val.textContent = input.value + " / 5";
      input.oninput = (e)=>{ state[id]=Number(e.target.value); val.textContent = e.target.value + " / 5"; save(); calc(); };
      display.appendChild(val);
    } else if(item.type==="select"){
      input = el("select");
      (item.options||[]).forEach(opt=>{const o=el("option"); o.value=opt.val; o.textContent=opt.label; input.appendChild(o);});
      input.value = (state[id]!==undefined) ? state[id] : (item.options?.[0]?.val ?? 0);
      input.oninput = (e)=>{ state[id]=Number(e.target.value); save(); calc(); };
    }
    const info = el("div");
    info.innerHTML = '<details class="info"><summary>More info</summary>' +
      '<div><div><strong>Why this matters:</strong> '+(item.why||"")+'</div>' +
      '<div style="margin-top:6px"><strong>How to improve:</strong> '+(item.how||"")+'</div>' +
      '<div style="margin-top:6px">'+ sdgBadges(item.sdgs) +'</div></div></details>';
    const inputCell = el("div"); inputCell.appendChild(input);
    container.appendChild(inputCell);
    container.appendChild(display);
    container.appendChild(info);
    return container;
  }

  function card(item){
    const card = el("div","card");
    const head = el("div","head");
    const left = el("div");
    left.innerHTML = '<div class="sub">'+item.sub+'</div><div class="label">'+item.label+'</div>';
    const right = inputFor(item);
    head.appendChild(left); head.appendChild(right); card.appendChild(head);
    return card;
  }

  function itemWeight(item){ return Number(item.weight||1); }
  function itemScore(item){
    const v = Number(state[item.id] ?? 0);
    let norm = 0;
    if(item.type==="tri") norm = v/5;
    else if(item.type==="percent") norm = Math.max(0, Math.min(1, v/100));
    else if(item.type==="scale") norm = v/5;
    else if(item.type==="select") norm = Math.max(0, Math.min(1, v/5));
    return norm * itemWeight(item);
  }
  function itemMax(item){ return itemWeight(item); }

  function chooseTier(overall){
    for (const t of TIERS){
      if (overall >= t.min) return t;
    }
    return TIERS[TIERS.length-1];
  }

  function calc(){
    const secs = {}, secMax={};
    ITEMS.forEach(it=>{
      secs[it.sec] = (secs[it.sec]||0) + itemScore(it);
      secMax[it.sec] = (secMax[it.sec]||0) + itemMax(it);
    });
    const secPct = {};
    Object.keys(secs).forEach(k=>{ secPct[k] = secMax[k] ? Math.round(100*secs[k]/secMax[k]) : 0; });

    let overall = 0;
    Object.keys(SECTION_WEIGHTS).forEach(k=> overall += (SECTION_WEIGHTS[k]||0) * (secPct[k]||0));
    overall = Math.round(overall);

    document.getElementById("prog").value = overall;
    document.getElementById("overallScore").textContent = overall + "/100";
    const tier = chooseTier(overall);
    document.getElementById("tier").textContent = (overall>=50) ? tier.name+" Café" : "Starter";
    document.getElementById("tierDot").style.background = tier.color;

    // lock/unlock certificate
    const locknote = document.getElementById("locknote");
    const btn1 = document.getElementById("print");
    const btn2 = document.getElementById("print2");
    if (overall >= 50){
      locknote.textContent = "Great! Your EcoBlend certificate is ready.";
      btn1.style.display = "inline-block"; btn2.style.display = "inline-block";
    } else {
      locknote.innerHTML = 'Reach at least <strong>50</strong> (Bronze) to unlock your EcoBlend certificate.';
      btn1.style.display = "none"; btn2.style.display = "none";
    }

    // section bars
    const secDiv = document.getElementById("secScores");
    secDiv.innerHTML = Object.keys(secPct).map(s=>'<div style="display:flex;align-items:center;gap:8px;margin:6px 0;">' +
      '<div class="pill" style="min-width:120px">'+s+'</div>' +
      '<progress max="100" value="'+secPct[s]+'"></progress>' +
      '<strong style="margin-left:8px">'+secPct[s]+'%</strong></div>').join("");

    // certificate fill
    const cafe = (state._cafeName || "Your Café");
    document.getElementById("certCafe").textContent = cafe;
    document.getElementById("certScore").textContent = overall + "/100";
    document.getElementById("tierBadge").textContent = (overall>=50) ? (tier.name+" Café") : "Starter";
    document.getElementById("tierBadge").style.borderColor = tier.color;
    document.getElementById("tierBadge").style.background = "#f7fbf8";
    document.getElementById("tierBadge").style.color = "#18392a";

    document.getElementById("certPlanet").textContent = (secPct["Planet"]||0) + "%";
    document.getElementById("certPeople").textContent = (secPct["People"]||0) + "%";
    document.getElementById("certProfit").textContent = (secPct["Profit"]||0) + "%";

    const entries = Object.entries(secPct).sort((a,b)=>a[1]-b[1]).slice(0,2);
    document.getElementById("focusAreas").textContent = entries.map(e=>e[0]).join(" & ");

    // date
    const d = new Date();
    document.getElementById("certDate").textContent = d.toLocaleDateString();

    return overall;
  }

  function render(){
    renderTabs();
    const listEl = document.getElementById("list"); listEl.innerHTML = "";
    ITEMS.filter(i => i.sec===active).forEach(item => listEl.appendChild(card(item)));
    calc();
  }

  function save(){ localStorage.setItem(KEY, JSON.stringify(state)); }

  window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("cafename").value = state._cafeName || "";
    document.getElementById("saveName").onclick = () => {
      state._cafeName = document.getElementById("cafename").value || "";
      save(); calc();
    };

    document.getElementById("reset").onclick = () => {
      if(confirm("Clear all answers?")){ state={"_active": active, "_cafeName": state._cafeName||""}; save(); render(); }
    };
    document.getElementById("export").onclick = () => {
      const header = ["ID","Section","Sub","Question","Answer (normalized)","Raw"];
      const rows = ITEMS.map(it=>{
        const raw = (state[it.id]!==undefined? state[it.id] : "");
        let norm = 0;
        if(it.type==="tri") norm = raw/5;
        else if(it.type==="percent") norm = Math.max(0, Math.min(1, raw/100));
        else if(it.type==="scale") norm = raw/5;
        else if(it.type==="select") norm = Math.max(0, Math.min(1, raw/5));
        return [it.id,it.sec,it.sub,it.label, norm.toFixed(2), raw];
      });
      const csv = [header].concat(rows).map(r => r.map(x => '"' + String(x).replace(/"/g,'""') + '"').join(",")).join("\\n");
      const overall = calc();
      const blob = new Blob([csv + "\\n\\nOverall Score,"+overall+"/100"], {type:"text/csv;charset=utf-8;"});
      const url = URL.createObjectURL(blob); const a=document.createElement("a");
      a.href=url; a.download="ecoblend_sustainability_results.csv"; a.click(); URL.revokeObjectURL(url);
    };
    function openCert(){ document.getElementById("certificate").style.display = "block"; window.print(); document.getElementById("certificate").style.display = "none"; }
    document.getElementById("print").onclick = openCert;
    document.getElementById("print2").onclick = openCert;
    render();
  });
  </script>
</body>
</html>
